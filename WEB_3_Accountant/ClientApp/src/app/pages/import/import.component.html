<h2 class="content-block">Import</h2>
<div class="content-block" id="import-page">
  <div class="dx-card responsive-paddings">
    <div *ngIf="excel.excelRow.length == 0 || newEmployeeAdd == false" class="upload-container">
      <div *ngIf="newEmployeeAdd == false" class="text-center text-danger">
        You need to modify your excel data because you have new employees (
        {{ EmployeeList }} ) are new and you declined to add them.
      </div>
      <div>
        <label for="file-input">
          <img class="image-upload" src="/assets/import-img.png" />
        </label>
      </div>
      <div>
        <input
          id="file-input"
          type="file"
          (change)="onFileChange($event)"
          accept=".xlsx"
          multiple="false"
        />
      </div>
    </div>
    <div *ngIf="excel.excelRow.length > 0 && newEmployeeAdd != false">
      <div>
        <h5>
          <b
            >Week {{ weekStart | date: "dd.MM.yy" }} -
            {{ weekEnd | date: "dd.MM.yy" }}</b
          >
        </h5>
      </div>
      <div class="table-container margin-bottom-15">
        <table class="custom-table">
          <thead class="table-head">
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Tax Percentage</th>
              <th scope="col">Hourly Rate</th>
              <th scope="col">Monday</th>
              <th scope="col">Tuesday</th>
              <th scope="col">Wednesday</th>
              <th scope="col">Thursday</th>
              <th scope="col">Friday</th>
              <th scope="col">Saturday</th>
              <th scope="col">Sunday</th>
              <th scope="col">Total hours</th>
              <th scope="col">Gross amount</th>
              <th scope="col">Net amount</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let row of excel.excelRow;let i=index">
              <td class="no-modify">{{row.name}}</td>
              <td class="no-modify">{{row.taxPercentage}}</td>
              <td class="no-modify">{{row.hourlyRate}}</td>

              <td *ngFor="let day of row.daysOfWork;let j=index" class="daysOfWorkTd">
                <div class="daysOfWorkItems">
                  <span>Project:</span>
                  <dx-text-box [(value)]="day.project" id="error-{{i}}c{{j}}1" [disabled]="checkWorkHours(day.workedHours)"></dx-text-box>
                  <div class="error-message">
                    {{checkError(i, "project", j)}}
                  </div>
                </div>

                <div class="daysOfWorkItems">
                  <span>Task:</span>
                  <dx-text-box [(value)]="day.task" id="error-{{i}}c{{j}}2" [disabled]="checkWorkHours(day.workedHours)"></dx-text-box>
                  <div class="error-message">
                    {{checkError(i, "task", j)}}
                  </div>
                </div>

                <div class="daysOfWorkItems">
                  <span>Worked Hours:</span>
                  <dx-text-box [(value)]="day.workedHours"></dx-text-box>
                </div>
              </td>

              <td>
                <dx-text-box [(value)]="row.totalHours" id="error-{{i}}1"></dx-text-box>
                <div class="error-message">
                  {{checkError(i, "total hours")}}
                </div>
              </td>
              <td>
                <dx-text-box [(value)]="row.grossAmount" id="error-{{i}}2"></dx-text-box>
                <div class="error-message">
                  {{checkError(i, "gross amount")}}
                </div>
              </td>
              <td>
                <dx-text-box [(value)]="row.netAmount" id="error-{{i}}3"></dx-text-box>
                <div class="error-message">
                  {{checkError(i, "-tax")}}
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="weekTotal margin-bottom-15">
        <div class="weekTotalItems">
          <span>Gross</span>
          <dx-text-box [(value)]="excel.totalGrossAmount" id="error--1"></dx-text-box>
          <div class="error-message error-total">
            {{checkError(-1, "total gross")}}
          </div>
        </div>
        <div class="weekTotalItems">
          <span>Net</span>
          <dx-text-box [(value)]="excel.totalNetAmount" id="error--2"></dx-text-box>
          <div class="error-message error-total">
            {{checkError(-1, "total net")}}
          </div>
        </div>
      </div>
      <div *ngIf="dataCalcVerified == false" class="text-center text-danger">
        Invalid calculations, please review them!
      </div>
      <div class="text-center margin-bottom-15">
        <div *ngIf="newEmployeesToAdd==false"class="text-success info-text" >There aren't new employees</div>
        <div
          *ngIf="
            isCheckingEmployees==false;
            then doneBlock;
            else checkEmployeeBlock
          "
        ></div>
        <ng-template #doneBlock>
          <dx-button
            (click)="onSubmit()"
            icon="check"
            type="success"
            text="Done"
          >
          </dx-button>
        </ng-template>
        <ng-template #checkEmployeeBlock>
          <div *ngIf="isCheckingEmployees!=true">
          <dx-button
            (click)="checkNewEmployees()"
            icon="check"
            type="warning"
            text="Check new employees"
          >
          </dx-button>
        </div>
        </ng-template>
      </div>
      <dx-popup
        [width]="400"
        [height]="280"
        [showTitle]="true"
        title="New Employees Confirmation"
        [dragEnabled]="false"
        [hideOnOutsideClick]="false"
        [showCloseButton]="false"
        [(visible)]="popupVisible"
      >

        <dxi-toolbar-item
          widget="dxButton"
          toolbar="bottom"
          location="before"
          [options]="confirmButtonOptions"
        >
        </dxi-toolbar-item>
        <dxi-toolbar-item
          widget="dxButton"
          toolbar="bottom"
          location="after"
          [options]="declineButtonOptions"
        >
        </dxi-toolbar-item>


        <dxo-position at="center" my="center"> </dxo-position>
        <dx-scroll-view width="100%" height="100%">
          <div class="popup-text-b">Do you want to add new employees ( {{EmployeeList}} ) to database?</div>
          <div class="popup-text">* If not you will need to change the excel.</div>
        </dx-scroll-view>
      </dx-popup>
    </div>
  </div>
</div>
